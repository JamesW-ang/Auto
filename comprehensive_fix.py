#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import os
import sys

# Complete mapping based on context analysis
# Each entry maps a garbled sequence to its correct Chinese text
COMPLETE_MAPPINGS = {
    # General patterns - most common
    "串口": "接收",  # In most file/log contexts
    "请求": "加",
    "秒": "化",
    "�": "收",
    "ӵ": "入",
    "�ݿ": "据库",
    "д": "写",
    "Ǳ": "是告",
    "ͬʱ": "同时",
    "뱨": "入报",
    "־": "志",
    "У": "行",
    "ʽ": "式",
    "�ָ": "分割",
    "ʵ": "实",
    "ȡ": "取",
    "ַ": "符",
    "Ϊ": "为",
    "�": "处",
    "�": "理",
    "У": "列",
    "�̨": "后台",
    "̣": "线",
    "߳": "程",
    "�Ӷ": "从队",
    "�": "列",
    "�": "出",
    "�": "取",
    "�ﵽ": "达到",
    "δ": "批",
    "С": "次大小",
    "�Ϊ": "或为",
    "定时": "最后",
    "ʱ": "一批时",
    "�د": "写入",
    "���": "数据库",
    "ʱ��": "超时",
    "����": "了但",
    "��д": "有写",
    "��": "也",
    "д��": "写入",
    "Ĭ": "错",
    "��": "误",
    "��": "不",
    "Ӱ��": "影响",
    "��": "继",
    "��": "续",
    "��": "处理",
    "�߳": "线程",
    "˳�": "退出",
    "ǰ": "前",
    "д": "写",
    "��": "入",
    "ʣ��": "剩余",
    "��־": "日志",
    
    # Specific phrases for DatabaseLoggerExtension
    "串口�ļ请求־秒Ϣ": "接收文件日志消息",
    "串口�־串口�ã�ֱ�ӷ请求": "未启用日志功能，直接返回",
    "请求ӵ串口ݿ�д串口�": "加入数据库写入队列",
    "串口Ǳ串口请求": "如果是告警级别",
    "串口ͬʱд�뱨串口": "同时写入报警表",
    "串口秒־�У�CSV秒ʽ秒": "解析日志行（CSV格式）",
    "�ָ�CSV秒": "分割CSV行",
    "秒ʵ�֣请求ȡǰ": "简单实现：提取前",
    "请求ַ请求Ϊ串口串口": "个字符作为告警码",
    "串口秒־请求У请求̨�̣߳�": "处理日志队列（后台线程）",
    "�Ӷ串口�ȡ串口־": "从队列取出日志",
    "�ﵽ请求δ�С串口�Ϊ定时串口秒д串口�ݿ�": "达到批次大小或为最后一批时，写入数据库",
    "定时串口�д�д串口־秒Ҳд串口�ݿ�": "超时了但有日志，也写入数据库",
    "秒Ĭ串口串口秒Ӱ串口串口": "错误不影响继续处理",
    "�߳秒˳�ǰ秒д秒ʣ串口־": "线程退出前写入剩余日志",
    "串口д串口�ݿ�": "批量写入数据库",
    "秒Ĭ串口串口秒ѭ串口秒": "错误不影响循环继续",
    "串口д串口־失败": "批量写入日志失败",
    "�ر串口ݿ请求־秒չ秒": "关闭数据库日志扩展",
    "ˢ�¶串口�ʣ串口־": "刷新队列剩余日志",
    "ֹͻ串口串口־": "停止接收日志",
    "�ȴ请求̨�̴߳串口�ʣ串口־": "等待后台线程处理完剩余日志",
    "�ȴ请求̨�߳秒˳�": "等待后台线程退出",
    "ǿ秒ˢ�¶串口е串口请求־串口�ݿ�": "强制刷新队列中的日志到数据库",
    "͸串口串口串口串口请求߳�": "同步调用会阻塞线程",
    "串口时间ȡ请求ڶ秒г请求": "调用时间取决于队列长度",
    "串口�ں�̨�̵߳请求": "不影响后台线程工作",
    "ȡ串口串口串口秒־": "取出所有待写日志",
    "д秒ʣ串口�־": "写入剩余日志",
    "ǿ秒ˢ串口ɣ�д秒": "强制刷新完成，写入",
    "ǿ秒刷新失败": "强制刷新失败",
    "未知秒վ": "未知工位",
    "秒Ҫ请求쳣串口秒": "不要抛异常回给",
    "串口秒־秒Ϣ失败": "接收日志消息失败",
    "请求ӱ请求失败": "添加告警失败",
    "串口Ϣ串口ȡ串口串口": "从消息中提取告警码",
    "秒ʵ�֣请求ȡǰ20请求ַ请求Ϊ串口串口": "简单实现：提取前20个字符作为告警码",
    
    # For BarcodeScanPage
    "串口ɨ请求¼�": "扫码事件监听",
    "�󶨰�ť事件": "绑定按钮事件",
    "请求ü秒̼请求": "设置键盘监听",
    "ģʽ�л秒¼�": "模式切换事件",
    "开始秒ɨ秒ģʽ": "初始化扫码模式",
    "串口ģ秒ģʽ请求Ƽ请求": "键盘模式（推荐）",
    "串口ͨ秒ģʽ": "串口通讯模式",
    "�ֶ串口�ģʽ串口�ԣ�": "手动输入模式（测试）",
    "Ĭ请求ֶ串口�ģʽ": "默认手动输入模式",
    "ҳ串口�": "页面加载",
    "Ĭ�ϳ�ʼ秒Ϊ�ֶ串口�ģʽ": "默认初始化为手动输入模式",
    "�ѳ�ʼ串口�ֶ串口�ģʽ": "已初始化手动输入模式",
    "串口ɨ串口开始秒成功": "扫码功能初始化成功",
    "提示串口请求Ϸ�ѡ秒ɨ秒ģʽ": "提示：请合理选择扫码模式",
    "串口ɨ秒ҳ串口串口": "扫码页面已加载",
    "串口ɨ秒ҳ串口�失败": "扫码页面加载失败",
    "ҳ串口�ʧ�ܣ�": "页面加载失败：",
    "ɨ秒ģʽ�л�": "扫码模式切换",
    "请求л串口请求ģ秒ģʽ": "切换到键盘模式",
    "�л串口请求ģ秒ģʽ": "切换到键盘模式",
    "�뽫秒꽹串口ڴ串口ϣ�Ȼ秒ɨ串口秒": "请将光标放在窗口上，然后扫码即可",
    "请求л串口请求ͨ秒ģʽ": "切换到串口通讯模式",
    "�л串口请求ͨ秒ģʽ": "切换到串口通讯模式",
    "秒ȷ秒ɨ秒ǹ串口�Ӵ请求": "请确保扫码枪已连接串口",
    "请求л串口ֶ串口�ģʽ": "切换到手动输入模式",
    "�л串口ֶ串口�ģʽ": "切换到手动输入模式",
    "串口�·秒ֶ串口�SN请求в请求": "请手动输入SN号并测试",
    "�л�ɨ秒ģʽ失败": "切换扫码模式失败",
    "ɨ请求¼串口�": "扫码事件处理",
    "ɨ�成功事件": "扫码成功事件",
    "提示请求ɨ请求SN": "显示最后扫描SN",
    "秒֤SN秒ʽ": "验证SN格式",
    "秒ʽ秒ȷ": "格式正确",
    "秒ʽ串口": "格式错误",
    "请求SN�Ƿ秒ظ�": "检查SN是否重复",
    "SN�Ѵ请求": "SN已存在",
    "SN串口": "SN不存在",
    "请求ӵ请求ʷ列表": "添加到历史列表",
    "串口串口ɫ": "设置颜色",
    "串口秒ʷ秒¼串口": "限制历史记录数",
    "秒¼秒־": "记录日志",
    "ɨ�赽": "扫到",
    "秒ʽ请求󣨱�׼秒ʽ秒": "格式错误（标准格式为",
    "λ串口C": "位，如C",
    "SN�Ѵ串口串口ݿ�": "SN已存在数据库",
    "串口ɨ串口失败": "处理扫码失败",
    "ɨ秒ʧ请求¼�": "扫码失败事件",
    "ɨ串口�": "扫码错误",
    "串口�¼串口请求ģ秒ģʽ秒": "键盘事件（键盘模式）",
    "请求̰串口¼�": "键盘按键事件",
    "请求ݸ�ɨ串口串口": "传递给扫码器",
    "串口串口串口失败": "处理按键失败",
    "�ֶ串口�": "手动输入",
    "�ֶ串口밴ť请求": "手动输入按钮点击",
    "串口秒SN": "请输入SN",
    "�ֶ串口�失败": "手动输入失败",
    "请求ɲ请求SN秒ť请求": "生成测试SN按钮点击",
    "请求ɲ请求SN": "生成测试SN",
    "秒䵽串口�": "填充到输入框",
    "秒־串口": "日志显示",
    "串口秒־": "添加日志",
    "串口提示": "更新显示",
    "串口秒־串口": "限制日志行数",
    "�Զ串口串口ײ�": "自动滚动到底部",
    "串口�־秒ť": "清空日志按钮",
    "秒־串口�": "日志已清空",
    "串口状态提示": "更新状态显示",
    "串口ر�": "窗体关闭",
    "ȡ串口请求¼�": "取消订阅事件",
    "串口ɨ秒ҳ秒ر�": "扫码页面已关闭",
    "�ر串口�ɨ秒ҳ秒失败": "关闭扫码页面失败",
    
    # For ProductSNManager
    "请求SN�Ƿ秒Ѵ请求": "检查SN是否已存在",
    "请求SN�ظ�失败": "检查SN重复失败",
    "串口请求κŲ�ѯ请求в�Ʒ": "根据批次号查询产品",
    "查询请求κ�失败": "查询批次号失败",
    "串口�Ʒ串口": "保存产品数据",
    "秒Ʒ串口Ϊ秒": "产品数据为空",
    "秒֤秒Ҫ字段": "验证必要字段",
    "秒ƷSNΪ秒": "产品SN为空",
    "请求SN�ظ�": "检查SN重复",
    "SN�Ѵ请求": "SN已存在",
    "请求浽数据库": "保存到数据库",
    "串口�Ʒ请求ݳɹ�": "保存产品数据成功",
    "串口�Ʒ串口失败": "保存产品数据失败",
    "请求ɲ请求SN": "生成测试SN",
    "秒ʽ秒C": "格式：C",
    "秒ȡ请求ղ请求": "获取今日产量",
    "秒ȡ串口串口": "获取今日良率",
    "秒ȡ缺陷统计": "获取缺陷统计",
    "秒ȡ串口ļ�¼": "获取最近记录",
    "秒ȡ串口�¼失败": "获取最近记录失败",
    
    # For DatabaseHelper
    "请求ݿ秒ļ�·串口串口请求ͬһĿ¼�µ�": "数据库文件路径放在与程序同一目录下的",
    "�ļ": "文件",
    "�": "夹",
    "串口ȷ串口�ṹ串口": "确保表结构存在",
    "请求ݿ开始串口�": "数据库初始化完成",
    "开始串口失败": "初始化失败",
    "��ջ": "堆栈",
    "秒ȡ请求ݿ串口�": "获取数据库连接",
    "ȷ串口�б串口请求": "确保所有表已创建",
    "串口串口�ݿ秒ļ�": "创建新数据库文件",
    "请求ݿ串口ӳɹ�": "数据库连接成功",
    "串口请求б�": "创建所有表",
    "ȷ��������ʧ��": "确保数据表失败",
    "串口请求б�": "创建所有表",
    "�������б�": "创建所有表",
    "�����û���": "创建用户表",
    "������־��": "创建日志表",
    "����������": "创建报警表",
    "�����������ݱ�": "创建生产数据表",
    "����ϵͳ���ñ�": "创建系统配置表",
    "Users ���������": "Users 表已创建",
    "Logs ���������": "Logs 表已创建",
    "Alarms ���������": "Alarms 表已创建",
    "ProductionData ���������": "ProductionData 表已创建",
    "SystemConfig ���������": "SystemConfig 表已创建",
    "����Ĭ���û�": "插入默认用户",
    "ϵͳ����Ա": "系统管理员",
    "Ĭ�Ϲ���Ա�˻�": "默认管理员账户",
    "����Ա": "操作员",
    "Ĭ�ϲ���Ա�˻�": "默认操作员账户",
    "����Ĭ���û�ʧ��": "插入默认用户失败",
    "����Ĭ������": "插入默认配置",
    "��־��������": "日志保留天数",
    "���β�ѯ�����־��": "单次查询最大日志数",
    "�Ƿ������Զ�����": "是否启用自动备份",
    "ͼ�񱣴�·��": "图像保存路径",
    "MQTT��������ַ": "MQTT服务器地址",
    "����Ĭ������ʧ��": "插入默认配置失败",
    "ִ�зǲ�ѯSQL����": "执行非查询SQL命令",
    "ִ�зǲ�ѯSQL����ⲿ���ã�": "执行非查询SQL命令（外部调用）",
    "ִ�в�ѯ�����ص���ֵ": "执行查询并返回单值",
    "ִ�в�ѯ������ DataTable": "执行查询并返回 DataTable",
    "����������־���������õı���������": "清理旧日志（根据系统设置的保留天数）",
    "��ȡ��־��������������": "获取日志保留天数配置",
    "ɾ��������־": "删除超期日志",
    "ɾ�����ڱ������Ѵ����ģ�": "删除超期且已处理的报警",
    "����������־ʧ��": "清理旧日志失败",
    "�������ݿ�": "备份数据库",
    "�������ݿ�ʧ��": "备份数据库失败",
    "�Ż����ݿ⣨ѹ�����ؽ�������": "优化数据库（压缩、重建索引）",
    "�Ż����ݿ�ʧ��": "优化数据库失败",
    
    # For ProductionDataService
    "串口串口": "添加记录",
    "串口�": "结果",
    "�Ӿ串口": "视觉数据",
    "串口串口": "测量数据",
    "请求ղ请求": "生产参数",
    "请求ݾ�字段": "兼容旧字段",
    "串口串口串口失败": "添加生产数据失败",
    "串口请求κŲ�ѯ请求в�Ʒ": "根据批次号查询产品",
    "查询请求κ�失败": "查询批次号失败",
    "秒ȡ串口ļ�¼": "获取最近记录",
    "秒ȡ串口�¼失败": "获取最近记录失败",
    "串口ʱ�䷶Χ查询": "按时间范围查询",
    "查询ʱ�䷶Χ失败": "查询时间范围失败",
    "ԭ�в�ѯ串口串口�ݣ�": "原始查询（兼容旧代码）",
    "ȫ串口վ": "全部工位",
    "秒ȡ串口ͳ�ƣ串口秒ڣ�": "获取日产量统计（按日期）",
    "秒ȡȱ串口秒统计": "获取缺陷类型统计",
    "串口ת秒": "数据转换",
    "秒 DataRow ת秒Ϊ ProductionDataModel串口ǿ�棩": "将 DataRow 转换为 ProductionDataModel（增强版）",
    "串口ͳ串口串口": "生产统计数据",
    
    # For AlarmService
    "串口串口秒": "报警服务",
    "请求ӱ请求": "添加报警",
    "串口串口ɸѡ串口秒": "查询报警（筛选条件）",
    "串口串口": "处理报警",
    "秒ȡ串口ͳ�ƣ串口죩": "获取报警统计（按日）",
    "秒ȡ串口ͳ�ƣ串口请求": "获取报警统计（按级别）",
    "秒 DataRow ת秒Ϊ AlarmModel": "将 DataRow 转换为 AlarmModel",
    
    # For LogService
    "秒־串口秒": "日志服务",
    "串口秒־": "添加日志",
    "串口串口秒־串口串口ܣ�": "批量添加日志（事务）",
    "秒͹": "事务提交",
    "��Դ": "回滚",
    "ʹ秒 datetime() 串口ȷ串口ȷ�Ƚ�": "使用 datetime() 函数确保正确比较",
    "秒͹秒־串口串口��": "按级别统计日志数",
    "ɾ秒ָ定时秒֮ǰ串口־": "删除指定日期之前日志",
    "秒 DataRow ת秒Ϊ LogModel": "将 DataRow 转换为 LogModel",
    
    # For UserService  
    "�û串口请求": "用户服务",
    "秒֤�û请求¼": "验证用户登录",
    "串口串口¼时间": "更新登录时间",
    "秒ȡ�û请求Ϣ": "获取用户信息",
    "秒ȡ串口用户": "获取所有用户",
    "串口用户": "添加用户",
    "串口用户": "更新用户",
    "ɾ请求û�": "删除用户",
    "秒秒ɾ秒admin用户": "禁止删除admin用户",
    "�޸串口�": "修改密码",
    "串口֤串口秒": "验证旧密码",
    "秒 DataRow ת秒Ϊ UserModel": "将 DataRow 转换为 UserModel",
    
    # For MotionControlPage
    "�˶�ģʽö秒": "运动模式枚举",
    "串口ģʽ": "绝对模式",
    "请求ģʽ": "相对模式",
    "秒ǰ�˶�ģʽ": "当前运动模式",
    "串口秒": "轴名称",
    "秒状态ָʾ串口秒": "轴状态指示控件",
    "秒ǰ秒λ�ã�ģ�⣩": "当前位置（模拟）",
    "JOG�˶串口ƣ�ʹ秒 Task 请求 Timer秒": "JOG运动控制（使用 Task 代替 Timer）",
    "秒ǰJOG秒": "当前JOG方向",
    "秒λ串口": "保存点位",
    "状态请求¿秒ƣ�ʹ秒 Task 请求 Timer秒": "状态更新控制（使用 Task 代替 Timer）",
    "串口串口串口": "后台线程",
    "CT 定时串口Ƕ请求˶串口ƣ�": "CT 节拍计时器嵌入运动逻辑）",
    "请求캯秒": "构造函数",
    "�˶串口�ҳ�洴串口请求ٹ秒죩": "运动控制页面构造完成（延迟加载）",
    "�ӳټ秒أ串口秒Ż请求": "延迟加载（性能优化）",
    "请求ٷ秒أ串口请求UI": "快速加载，不阻塞UI",
    "�˶串口�ҳ请求ѳ�ʼ串口串口": "运动控制页面已初始化过了",
    "�˶串口�ҳ串口ʾ请求ӳټ请求ģʽ秒": "运动控制页面显示（延迟加载模式）",
    "提示串口提示串口ѡ秒": "显示加载指示器",
    "�첽开始请求ؼ�": "异步初始化控件",
    "秒UI�߳秒г�ʼ请求ؼ�": "在UI线程上初始化控件",
    "开始�첽开始请求ؼ�": "开始异步初始化控件",
    "�˶�ģʽѡ串口串口�٣�": "运动模式选择器（快速）",
    "串口秒ƣ串口٣�": "方向控制（快速）",
    "秒状态秒أ串口请求~": "轴状态监控（约~",
    "串口请求壨请求٣�": "轴控制面板（快速）",
    "秒λ串口串口�٣�": "点位管理（快速）",
    "请求ر请求ĵ�λ串口�٣�": "加载保存的点位（快速）",
    "串口状态串口串口": "启动状态更新任务",
    "请求ؼ串口�ʾ": "隐藏加载指示器",
    "�˶串口�ҳ�开始串口ɣ秒첽秒": "运动控制页面初始化完成（异步）",
    "�˶串口�ҳ�开始串口ȡ秒": "运动控制页面初始化取消了",
    "�˶串口�ҳ�开始秒失败": "运动控制页面初始化失败",
    "ҳ�开始秒ʧ�ܣ�": "页面初始化失败：",
    "串口串口提示": "显示加载提示",
    "串口�ڴ串口Ӽ秒ض串口�提示": "可以在这里添加实际的加载提示",
    "串口秒": "加载中",
    "请求ؼ串口�ʾ": "隐藏加载指示器",
    "开始请求˶�ģʽѡ串口": "初始化运动模式选择器",
    "串口ģʽ": "绝对模式",
    "�л串口请求ģʽ": "切换到绝对模式",
    "�л串口秒ģʽ": "切换到相对模式",
    "�л请求JOGģʽ": "切换到JOG模式",
    "Ĭ秒ѡ串口�ģʽ": "默认选择绝对模式",
    "串口ģʽ˵秒": "更新模式说明",
    "串口ģʽ请求ƶ请求ָ串口秒λ秒": "绝对模式：移动到指定的绝对位置",
    "请求ģʽ请求ӵ�ǰλ请求ƶ�ָ串口秒": "相对模式：从当前位置移动指定距离",
    "JOGģʽ串口ס秒ť串口�ƶ串口ɿ�ֹͣ": "JOG模式：按住按钮持续移动，松开停止",
    "开始串口串口ư�ť": "初始化方向控制按钮",
    "串口秒ť": "方向按钮",
    "串口秒ť": "美化按钮",
    "秒갴秒": "鼠标按下",
    "开始�ƶ�": "开始移动",
    "串口ͷ�": "鼠标抬起",
    "ֹͣ�ƶ�": "停止移动",
    "请求": "单击",
    "串口�ƶ�": "步进移动",
    "串口串口ť": "美化按钮",
    "秒ͣЧ秒": "鼠标悬停效果",
    "开始JOG�˶请求ʹ秒 Task 请求 Timer秒": "开始JOG运动（使用 Task 代替 Timer）",
    "串口串口串口串口У请求ֹͻ": "如果有正在运行的，先停止",
    "串口秒JOG串口": "启动异步JOG任务",
    "请求ݷ串口秒λ秒": "根据方向移动位置",
    "ÿ请求ƶ�": "每次移动",
    "UI�̸߳串口�ʾ": "UI线程更新显示",
    "串口ȡ串口串口¼串口": "取消了，不记录日志",
    "JOG�˶秒쳣": "JOG运动异常",
    "ֹͻJOG�˶�": "停止JOG运动",
    "ִ�е串口ƶ�": "执行步进移动",
    "请求ģʽ请求ӵ�ǰλ请求ƶ�": "相对模式：从当前位置移动",
    "串口ƶ�": "步进移动",
    "串口ģʽ串口串口串口串口秒Ŀ秒λ秒": "绝对模式：请直接输入目标位置",
    "串口�ƶ�失败": "步进移动失败",
    "请求ݷ串口秒λ秒": "根据方向更新位置",
    "�Խ秒߷串口ϵ秒": "对角线方向系数",
    "秒状态请求": "轴状态监控",
    "开始串口状态请求": "初始化轴状态监控",
    "串口秒": "停止",
    "串口": "运行",
    "秒ͣ": "急停",
    "请求": "到位",
    "串口": "伺服",
    "串口�첽状态串口串口请求 Timer秒": "启动异步状态更新任务（代替 Timer）",
    "ȡ串口串口秒": "取消旧任务",
    "串口秒̨串口": "启动后台任务",
    "串口秒状态": "更新轴状态",
    "状态串口异常": "状态更新异常",
    "串口秒状态": "更新轴状态",
    "TODO": "TODO",
    "秒PLC请求˶串口ƿ请求ȡ实现状态": "从PLC或运动控制卡读取真实状态",
    "串口ʹ秒ģ串口秒": "这里使用模拟数据",
    "ģ秒状态秒实现Ӧ秒Ӳ串口ȡ秒": "模拟状态，实际应从硬件读取）",
    "串口串口": "正限位",
    "串口": "负限位",
    "ԭ秒": "原点",
    "请求": "到位",
    "秒ͣ": "急停",
    "秒λ": "伺服",
    "串口": "使能",
    "请求µ请求状态ָʾ秒": "更新单个状态指示器",
    "UI�̰߳�ȫ串口": "UI线程安全更新",
    "秒Ĭ串口串口串口串口请求": "错误不影响其他更新",
    "串口状态ָʾ秒失败": "更新状态指示器失败",
    "串口串口": "轴控制",
    "开始串口串口秒": "初始化轴控制面板",
    "串口秒": "X轴",
    "串口": "Y轴",
    "�ƶ串口Ŀ秒λ秒": "移动到目标位置",
    "秒ԭ秒": "回原点",
    "串口请求": "清除错误",
    "串口串口ʾ": "初始化显示",
    "串口秒λ串口ʾ": "更新轴位置显示",
    "�ƶ请求Ŀ秒λ秒": "移动到目标位置",
    "串口串口串口秒߼�": "实际移动逻辑",
    "ģ�⣺ֱ串口秒λ秒": "模拟：直接设置位置",
    "�ƶ串口": "移动完成",
    "串口串口Ч秒Ŀ秒λ秒": "请输入有效的目标位置",
    "�ƶ�失败": "移动失败",
    "秒ԭ秒": "回原点",
    "开始秒ԭ秒": "开始回原点",
    "ʵ�ʻ�ԭ请求߼�": "实际回原点逻辑",
    "ģ�⣺ֱ串口秒Ϊ": "模拟：直接设置为",
    "秒ԭ串口�": "回原点完成",
    "秒ԭ秒失败": "回原点失败",
    "串口请求": "清除错误",
    "ʵ串口串口秒߼�": "实际清除错误逻辑",
    "串口请求": "错误已清除",
    "串口串口�": "清除成功",
    "秒λ串口": "点位管理",
    "开始串口λ串口": "初始化点位管理",
    "DataGridView串口": "DataGridView设置",
    "串口秒": "添加列",
    "秒λ串口": "点位名称",
    "串口秒": "X坐标",
    "串口": "Y坐标",
    "秒ť串口¼�": "按钮列事件",
    "DataGridView秒ť请求": "DataGridView按钮点击",
    "�ƶ串口˵�": "移动到该点",
    "请求´˵�": "更新该点",
    "串口�µ�λ": "添加新点位",
    "ʹ�ü򵥵串口�Ի请求": "使用简单对话框",
    "请求ӵ�λ": "添加点位",
    "秒λ串口": "点位名称",
    "�µ�λ": "新点位",
    "ȷ秒": "确定",
    "ȡ秒": "取消",
    "请求ӵ�λ": "添加点位",
    "ɾ串口λ": "删除点位",
    "ȷ秒Ҫɾ串口λ": "确定要删除点位",
    "ȷ秒ɾ秒": "确认删除",
    "ɾ串口λ": "删除点位",
    "串口ѡ秒Ҫɾ请求ĵ�λ": "请选择要删除的点位",
    "�ƶ请求ָ串口λ": "移动到指定点位",
    "�ƶ串口�λ": "移动到点位",
    "ʵ请求ƶ秒߼�": "实际移动逻辑",
    "ģ�⣺ֱ串口秒λ秒": "模拟：直接设置位置",
    "请求ƶ串口�λ总产量：": "已移动到点位：",
    "�ƶ串口�λ": "移动到点位",
    "请求µ�λ串口": "更新点位坐标",
    "秒λ": "点位",
    "�Ѹ请求": "已更新",
    "ˢ�µ�λ列表": "刷新点位列表",
    "串口�λ串口请求ļ�": "保存点位到文件",
    "ʵ�时间浽串口�ļ串口秒ݿ�": "实际保存到文件或数据库",
    "串口": "保存",
    "串口λ": "个点位",
    "�ɹ串口�": "成功保存",
    "串口�λ失败": "保存点位失败",
    "串口请求ļ串口ص�λ": "从文件或数据库加载点位",
    "串口请求ļ串口秒ݿ串口": "从文件或数据库加载",
    "ģ�⣺串口һЩĬ�ϵ�λ": "模拟：添加一些默认点位",
    "串口λ": "装配位",
    "请求λ": "检测位",
    "串口λ": "下料位",
    "串口": "加载",
    "秒λ串口秒": "点位数据类",
    "�˶请求λ串口": "运动点位数据",
    "ִ串口串口�ڣ请求 CT 定时秒": "执行生产周期（含 CT 节拍计时）",
    "定时ԭ秒": "计时原理",
    "串口开始ǰ Start": "周期开始前 Start",
    "串口秒ɺ� Mark": "阶段完成后 Mark",
    "请求ж串口�ɺ� Stop": "全部工序完成后 Stop",
    "ʹ秒 LoggingCycleTimer �Զ请求¼秒־": "使用 LoggingCycleTimer 自动记录日志",
    "ʹ秒 LoggingCycleTimer请求Զ请求¼秒־秒": "使用 LoggingCycleTimer：自动记录日志）",
    "开始定时请求Զ请求ӡ秒־秒": "开始计时（自动打印日志）",
    "请求϶请求": "上料动作",
    "串口请求": "装配完成",
    "�Զ请求ӡ秒": "自动打印：",
    "秒⶯秒": "检测动作",
    "串口秒": "检测完成",
    "请求϶请求": "下料动作",
    "串口请求": "下料完成",
    "ֹͻ定时请求Զ请求ӡ定时�䣩": "停止计时（自动打印节拍时间）",
    "秒ѡ串口�浽数据库": "可选：保存到数据库",
    "串口串口异常": "生产周期异常",
    "�˶串口Ʒ串口请求ʵ请求˶秒߼请求": "运动控制方法（实际运动逻辑）",
    "�ƶ串口请求λ秒": "移动到上料位置",
    "开始�ƶ串口请求λ": "开始移动到上料位",
    "ʵ�实现˶串口ƴ请求": "实际实现运动控制代码",
    "串口Ŀ秒λ秒": "设置目标位置",
    "�ƶ串口秒λ秒": "移动到检测位置",
    "开始�ƶ串口秒λ": "开始移动到检测位",
    "�ƶ串口请求λ秒": "移动到下料位置",
    "开始�ƶ串口请求λ": "开始移动到下料位",
    "�ȴ秒ᵽλ": "等待轴到位",
    "ʵ�ʵĵ�λ串口秒": "实际的到位检测",
    "ģ�⣺�ȴ�": "模拟：等待",
    "串口ر�": "窗体关闭",
    "ȡ串口ʼ串口秒": "取消初始化任务",
    "ȡ串口请求첽串口": "取消所有异步任务",
    "运动控制页面ر�": "运动控制页面已关闭",
    "�ر秒˶串口�ҳ秒失败": "关闭运动控制页面失败",
}

def fix_file(file_path):
    """Fix a single file using the complete mappings"""
    try:
        print(f"\n{'='*80}")
        print(f"Processing: {os.path.basename(file_path)}")
        print('='*80)
        
        with open(file_path, 'r', encoding='utf-8', errors='replace') as f:
            content = f.read()
        
        original_garbled_count = content.count('�')
        print(f"Original garbled characters (�): {original_garbled_count}")
        
        fixes_applied = 0
        for garbled, correct in COMPLETE_MAPPINGS.items():
            if garbled in content:
                count = content.count(garbled)
                content = content.replace(garbled, correct)
                fixes_applied += count
                if count > 0:
                    print(f"  ✓ Fixed '{garbled[:40]}...' -> '{correct[:40]}...' ({count}x)")
        
        new_garbled_count = content.count('�')
        
        if fixes_applied > 0 or new_garbled_count < original_garbled_count:
            with open(file_path, 'w', encoding='utf-8') as f:
                f.write(content)
            print(f"\n✓ File updated:")
            print(f"  - Applied {fixes_applied} replacements")
            print(f"  - Remaining garbled chars: {original_garbled_count} -> {new_garbled_count}")
            return True
        else:
            print("\n- No changes needed")
            return False
            
    except Exception as e:
        print(f"\n✗ Error: {e}")
        import traceback
        traceback.print_exc()
        return False

def main():
    files = [
        "/Users/james/Desktop/workspace/Auto/COTUI/通用功能类/DatabaseLoggerExtension.cs",
        "/Users/james/Desktop/workspace/Auto/COTUI/扫码管理/BarcodeScanPage.cs",
        "/Users/james/Desktop/workspace/Auto/COTUI/扫码管理/ProductSNManager.cs",
        "/Users/james/Desktop/workspace/Auto/COTUI/数据库/DatabaseHelper.cs",
        "/Users/james/Desktop/workspace/Auto/COTUI/数据库/Services/ProductionDataService.cs",
        "/Users/james/Desktop/workspace/Auto/COTUI/数据库/Services/AlarmService.cs",
        "/Users/james/Desktop/workspace/Auto/COTUI/数据库/Services/LogService.cs",
        "/Users/james/Desktop/workspace/Auto/COTUI/数据库/Services/UserService.cs",
        "/Users/james/Desktop/workspace/Auto/COTUI/运动控制页面/MotionControlPage.cs",
    ]
    
    print("="*80)
    print("GBK Garbled Character Fix Utility - Comprehensive Edition")
    print("="*80)
    print(f"Target: {len(files)} files")
    print(f"Mappings loaded: {len(COMPLETE_MAPPINGS)}")
    
    fixed_files = 0
    for file_path in files:
        if os.path.exists(file_path):
            if fix_file(file_path):
                fixed_files += 1
        else:
            print(f"\n✗ File not found: {file_path}")
    
    print("\n" + "="*80)
    print(f"SUMMARY: Successfully fixed {fixed_files} out of {len(files)} files")
    print("="*80)

if __name__ == "__main__":
    main()
